<!DOCTYPE html>
<html lang="en">    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Weather Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAQmL_8cxdWiC920C-GnrV6GS4S_wBV5y0",
            authDomain: "esp32-weather-dashboard.firebaseapp.com",
            projectId: "esp32-weather-dashboard",
            storageBucket: "esp32-weather-dashboard.firebasestorage.app",
            messagingSenderId: "846543764599",
            appId: "1:846543764599:web:de34bec4b89969043cda72"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const TEMP_ID = "temp-value";
        const TIME_ID = "time-stamp";

        const docPath = "artifacts/default-app-id/public/data/weatherData/current_readings";

        function updatedashboard(data) {
            document.getElementById(TEMP_ID).textContent = `${data.temperature || '--'}°C`;
            document.getElementById(TIME_ID).textContent = `Last Updated : ${data.timestamp || '--'}`;
        }

        async function startRealTimeListener(){
            await signInAnonymously(auth);
            onSnapshot(doc(db, docPath), (docSnap) => {
                if(docSnap.exists()){
                    const data = docSnap.data();
                    updatedashboard(data);
                }
            });
        }

        startRealTimeListener();
    </script>
</head>

<body class = "weather-app-body">
    <div class = "weather-container">
        <h1>Live Weather Dashboard</h1>
        <div class = "temperature-card">
            <p class = "card-title"> Current Temperature</p>
            <p class = "card-value" id="temp-value"> -- °C</p>
        </div>
        <p id = "time-stamp" class = "update-time"> Last Updated: -- </p>
    </div>
</body>
</html>